const yt_watch_string="https://www.youtube.com/watch?v=";var captured_data=[];function submit_captured_data(t,e){var a,s,d=t.findIndex(t=>t.id===e);console.log(d),-1!==d?(a=t[d].data,s=t[d].assessments,s=JSON.stringify({session_data:a,assessment_data:s}),t.splice(d,1),fetch(" http://127.0.0.1:5000/new_session",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:s}).then(t=>t.json()).then(t=>console.log(t))):console.log("No data to submit");}chrome.runtime.onInstalled.addListener(()=>{const t={ASSESSMENT_PANEL_OPACITY:80,ASSESSMENT_INTERVAL_MS:5e3,ASSESSMENT_MODE:"auto",ASSESSMENT_PANEL_LAYOUT:"middle",ASSESSMENT_PAUSE:"disabled"};chrome.storage.local.set(t,()=>{console.log("Config has been saved: "+t);});}),chrome.webNavigation.onHistoryStateUpdated.addListener(e=>{0===e.frameId&&e.url.includes(yt_watch_string)&&chrome.tabs.get(e.tabId,t=>{t.url===e.url&&(0<captured_data.length?submit_captured_data(captured_data,e.tabId):console.log("No data captured yet"),chrome.tabs.executeScript(t.id,{file:"init.js"}));});}),chrome.webNavigation.onCommitted.addListener(e=>{0===e.frameId&&e.url.includes(yt_watch_string)&&chrome.tabs.get(e.tabId,t=>{t.url===e.url&&["reload","typed","link"].includes(e.transitionType)&&e.url.includes(yt_watch_string)&&chrome.tabs.executeScript(e.tabId,{file:"init.js"});});}),chrome.tabs.onUpdated.addListener((t,e,a)=>{"complete"!=e.status||a.url.includes(yt_watch_string)||(chrome.tabs.sendMessage(t,{msg:"stop"}),submit_captured_data(captured_data,a.id));}),chrome.runtime.onMessage.addListener((t,e,a)=>{if("data_handover"==t.msg){var s=t.data;const n=e.tab.id,o=captured_data.find(t=>t.id===n);void 0!==o?o.data.push(s):(d={id:n,data:[s]},captured_data.push(d));}if("assessment_handover"==t.msg){var d=t.data;const i=e.tab.id,r=captured_data.find(t=>t.id===i);void 0!==r&&(void 0!==r.assessments?r.assessments.push(d):Object.assign(r,{assessments:[d]}));}else "onbeforeunload"==t.msg&&(submit_captured_data(captured_data,e.tab.id),"video_end"==t.type&&chrome.tabs.sendMessage(e.tab.id,{msg:"stop"}));});
